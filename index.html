<!DOCTYPE HTML>

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width;initial-scale=1.0;maximum-scale=1.0;user-scalable=0;"/>
<title>Tiler</title>

<style>
  body {
    display:block;
    overflow:hidden;
    margin:0;
    padding:0;
  }
  
  #viewport {
    position:absolute;
    height:100%;
    width:100%;
  }
</style>

<div id="viewport"></div>

<script src="http://code.jquery.com/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.8.19/jquery-ui.min.js"></script>

<script src="https://raw.github.com/borbit/jquery.scraggable/master/jquery.scraggable.min.js"></script>
<script src="https://raw.github.com/furf/jquery-ui-touch-punch/master/jquery.ui.touch-punch.min.js"></script>

<script src="https://raw.github.com/borbit/row.js/master/row.js"></script>
<script src="https://raw.github.com/borbit/grid.js/master/grid.js"></script>
<script src="https://raw.github.com/borbit/tiler/master/tiler.js"></script>

<script>        
  $(function() {
    var host = 'https://s3.amazonaws.com/serge.borb.it/tiler/';
    var tiler = new Tiler($('#viewport'), {
      tileSize: 200,
      
      sync: function(options, callback) {
        var tosync = options.tosync;
        
        tosync.forEach(function(tile) {
          var img = new Image();
          var x = tile[0];
          var y = tile[1];
          
          img.onload = function() {
            callback([[x, y, $('<img/>').attr('src', img.src)]]);
          };
          
          img.src = host + 'nodejs_' + x + '_' + y + '.png';
        });
      }
    });
      
    tiler.binder.draggable();
    tiler.binder.scraggable();
  });
</script>